<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>汕尾市革命遗址数量统计</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <style>
        #main {
            width: 1000px;
            height: 700px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #333;
            margin: 20px 0 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
        }
        .download-btn {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #c23531;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .download-btn:hover {
            background-color: #a52a2a;
        }
        .footer {
            text-align: center;
            margin-top: 20px;
            color: #999;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>汕尾市革命遗址数量统计</h1>
    <div class="subtitle">全市革命遗址总数：617处</div>
    <div id="main"></div>
    <button class="download-btn" onclick="downloadImage()">保存为图片</button>
    <div class="footer">数据更新时间：2023年 | 来源：汕尾市革命遗址普查数据</div>
    
    <script>
        // 初始化ECharts实例
        var myChart = echarts.init(document.getElementById('main'));
        
        // 准备数据
        var data = {
            '海丰县': {
                value: 332,
                towns: {
                    '海城镇': 39,
                    '城东镇': 25,
                    '附城镇': 5,
                    '梅陇镇': 41,
                    '鲘门镇': 14,
                    '小漠镇': 1,
                    '赤石镇': 39,
                    '鹅埠镇': 4,
                    '联安镇': 21,
                    '可塘镇': 12,
                    '陶河镇': 19,
                    '赤坑镇': 17,
                    '大湖镇': 5,
                    '公平镇': 27,
                    '平东镇': 7,
                    '黄羌镇': 41,
                    '黄羌林场': 15
                }
            },
            '陆丰市': {
                value: 82,
                towns: {
                    '八万镇': 7,
                    '陂洋镇': 3,
                    '城东街道': 1,
                    '大安农场': 1,
                    '大安镇': 4,
                    '东海街道': 19,
                    '河东镇': 5,
                    '河西街道': 5,
                    '湖东镇': 3,
                    '甲东镇': 2,
                    '甲西镇': 1,
                    '甲子镇': 3,
                    '碣石镇': 3,
                    '金厢镇': 12,
                    '南塘镇': 2,
                    '桥冲镇': 2,
                    '上英镇': 1,
                    '潭西镇': 3,
                    '西南镇': 3,
                    '星都开发区': 1,
                    '博美镇': 1
                }
            },
            '陆河县': {
                value: 103,
                towns: {
                    '东坑镇': 11,
                    '河口镇': 33,
                    '河田镇': 9,
                    '螺溪镇': 5,
                    '南万镇': 4,
                    '上护镇': 3,
                    '水唇镇': 10,
                    '新田镇': 28
                }
            },
            '城区': {
                value: 60,
                towns: {
                    '东涌镇': 23,
                    '凤山街道': 13,
                    '红草镇': 8,
                    '捷胜镇': 9,
                    '香洲街道': 1,
                    '新港街道': 4,
                    '马宫街道': 2
                }
            },
            '红海湾开发区': {
                value: 35,
                towns: {
                    '东洲街道': 3,
                    '田墘街道': 22,
                    '遮浪街道': 8,
                    '副编': 2
                }
            },
            '华侨管理区': {
                value: 5,
                towns: {
                    '华侨管理区': 5
                }
            }
        };

        // 准备图表数据
        var counties = Object.keys(data);
        var countyData = counties.map(function(county) {
            return {
                name: county,
                value: data[county].value
            };
        });

        // 配置项
        var option = {
            title: {
                text: '各县市区革命遗址数量分布',
                subtext: '点击柱状图查看各乡镇街道详情',
                left: 'center',
                top: 10,
                textStyle: {
                    fontSize: 18,
                    fontWeight: 'bold'
                }
            },
            tooltip: {
                trigger: 'item',
                formatter: function(params) {
                    const percent = (params.value / 617 * 100).toFixed(1);
                    return `
                        <strong>${params.name}</strong><br/>
                        遗址数量: ${params.value}处<br/>
                        占比: ${percent}%
                    `;
                }
            },
            xAxis: {
                type: 'category',
                data: counties,
                axisLabel: {
                    interval: 0,
                    rotate: 0,
                    fontSize: 12
                },
                axisLine: {
                    lineStyle: {
                        color: '#666'
                    }
                }
            },
            yAxis: {
                type: 'value',
                name: '遗址数量(处)',
                axisLine: {
                    show: true,
                    lineStyle: {
                        color: '#666'
                    }
                },
                splitLine: {
                    lineStyle: {
                        type: 'dashed'
                    }
                }
            },
            series: [{
                name: '遗址数量',
                type: 'bar',
                barWidth: '50%',
                data: countyData.map(item => ({
                    value: item.value,
                    name: item.name,
                    itemStyle: {
                        color: getColor(item.name)
                    }
                })),
                label: {
                    show: true,
                    position: 'top',
                    formatter: '{c}处',
                    color: '#333'
                },
                emphasis: {
                    itemStyle: {
                        shadowBlur: 10,
                        shadowOffsetX: 0,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                }
            }],
            toolbox: {
                right: 20,
                top: 10,
                feature: {
                    saveAsImage: {
                        title: '保存图片',
                        pixelRatio: 2,
                        name: '汕尾市革命遗址统计'
                    },
                    dataView: {
                        title: '查看数据',
                        readOnly: true,
                        lang: ['数据视图', '关闭', '刷新']
                    },
                    magicType: {
                        title: {
                            line: '折线图',
                            bar: '柱状图',
                            pie: '饼图'
                        },
                        type: ['line', 'bar', 'pie']
                    },
                    restore: {
                        title: '还原'
                    }
                }
            }
        };

        // 颜色配置函数
        function getColor(county) {
            const colors = {
                '海丰县': '#c23531',
                '陆丰市': '#2f4554',
                '陆河县': '#61a0a8',
                '城区': '#d48265',
                '红海湾开发区': '#91c7ae',
                '华侨管理区': '#749f83'
            };
            return colors[county] || '#999';
        }

        // 使用配置项显示图表
        myChart.setOption(option);
        
        // 点击事件 - 显示乡镇详情
        myChart.on('click', function(params) {
            var countyName = params.name;
            var townData = data[countyName].towns;
            
            var towns = Object.keys(townData);
            var townValues = towns.map(function(town) {
                return {
                    name: town,
                    value: townData[town]
                };
            });
            
            // 按数量排序
            townValues.sort(function(a, b) {
                return b.value - a.value;
            });
            
            var townOption = {
                title: {
                    text: countyName + '各乡镇街道革命遗址数量',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c}处'
                },
                xAxis: {
                    type: 'category',
                    data: townValues.map(item => item.name),
                    axisLabel: {
                        interval: 0,
                        rotate: 30,
                        fontSize: 10
                    }
                },
                yAxis: {
                    type: 'value',
                    name: '遗址数量(处)'
                },
                series: [{
                    name: '遗址数量',
                    type: 'bar',
                    data: townValues.map(item => ({
                        value: item.value,
                        name: item.name,
                        itemStyle: {
                            color: getColor(countyName)
                        }
                    })),
                    label: {
                        show: true,
                        position: 'top',
                        formatter: '{c}处',
                        fontSize: 10
                    }
                }],
                grid: {
                    bottom: '30%'
                }
            };
            
            myChart.setOption(townOption);
        });
        
        // 窗口大小变化时重绘图表
        window.addEventListener('resize', function() {
            myChart.resize();
        });
        
        // 保存图片函数
        function downloadImage() {
            var url = myChart.getDataURL({
                type: 'png',
                pixelRatio: 2,
                backgroundColor: '#fff'
            });
            var link = document.createElement('a');
            link.href = url;
            link.download = '汕尾市革命遗址统计.png';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>